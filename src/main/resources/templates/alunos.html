<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" data-bs-theme="dark">

<head>
	<title>Alunos</title>
	<div th:replace="~{fragments/head}"></div>
</head>

<body>
	<div th:replace="~{fragments/sidebar}"></div>

	<div th:replace="~{fragments/header}"></div>

	<div class="container">
		<div class="row mt-4">
			<div class="col-md-8">
				<h2>Alunos</h2>
			</div>
			<div class="col-md-4 text-right">
				<a href="/alunos/cadastrar" class="btn btn-success">
					<i class="fas fa-plus"></i> Novo
				</a>
			</div>
		</div>
		<div class="card-container">
			<table class="table mt-4 custom-table">
				<thead>
					<tr>
						<th>ID</th>
						<th>Nome</th>
						<th>E-mail</th>
						<th>Ações</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>

	<div th:replace="~{fragments/scripts}"></div>
	<script>
		fetch('http://localhost:8080/students')
			.then(response => response.json())
			.then(data => {
				data.forEach(student => {
					const row = document.createElement('tr');
					row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.email}</td>
						<td>
							<a href="/editar/${student.id}" class="btn btn-sm btn-primary">
								<i class="fas fa-pencil-alt"></i>
							</a>
							<a href="#" class="btn btn-sm btn-danger" onclick="deleteStudent(${student.id})">
								<i class="fas fa-trash"></i>
							</a>
						</td>
                    `;
					document.querySelector('tbody').appendChild(row);
				});
			})
			.catch(error => {
				console.error('Ocorreu um erro ao obter os dados dos alunos:', error);
			});
		// <a th:href="@{/students/{id}(id=${student.id})}" class="btn btn-sm btn-danger" role="button">
		// 					<i class="fas fa-trash"></i>
		// 				</a>

		function deleteStudent(id) {
			if (confirm('Deseja realmente excluir este aluno?')) {
				fetch(`/students/${id}`, {
					method: 'DELETE'
				})
					.then(response => {
						if (response.ok) {
							location.reload();
						} else {
							console.error('Ocorreu um erro ao excluir o aluno.');
						}
					})
					.catch(error => {
						console.error('Ocorreu um erro ao excluir o aluno:', error);
					});
			}
		}
	</script>
</body>

</html>